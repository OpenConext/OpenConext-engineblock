Feature:
  In order to prevent an XML signature bypass vulnerability
  As a user
  I need EB to throw an exception to prevent further processing of a tampered with SAML Response

  Background:
    Given an EngineBlock instance on "dev.openconext.local"
    And no registered SPs
    And no registered Idps
    And an Identity Provider named "IdP"
    And a Service Provider named "SP"

  Scenario: Throw an exception if the assertion signature is tampered with
    When I log in at "SP"
      And I pass through EngineBlock
      # See the step definition code for more details on how EngineBlock was vulnerable.
    Then I exploit the XML signature bypass vulnerability after passing through the IdP
    # An invalid SAML Response results in an unknown error
    Then the url should match "/feedback/unknown-error"
      # And the updated uid should not be in the response body
      And the response should not contain "ADMIN!"
      And the response status code should be 500
